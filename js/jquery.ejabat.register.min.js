function validateLogin(a,e,s){a.removeClass("invalid"),s.removeClass("invalid"),s.html(ejabat.checking_login);var i=a.val();if(i){var l=new RegExp(ejabat.login_regexp);l.test(i)?jQuery.ajax({method:"POST",url:ejabat.ajax_url+"?action=ejabat_check_login",timeout:ejabat.timeout,data:"login="+i+"&host="+e.val(),dataType:"json",success:function(e){"success"==e.status?(a.removeClass("invalid"),s.removeClass("invalid"),s.html(e.message),val_login=!0):(a.addClass("invalid"),s.addClass("invalid"),s.html(e.message),val_login=!1)},error:function(){a.addClass("invalid"),s.addClass("invalid"),s.html(ejabat.error),val_login=!1}}):(a.addClass("invalid"),s.addClass("invalid"),s.html(ejabat.invalid_login),val_login=!1)}else a.addClass("invalid"),s.addClass("invalid"),s.html(ejabat.empty_field),val_login=!1}function validatePassword(a,e){var s=a.val(),i=wp.passwordStrength.meter(s,wp.passwordStrength.userInputBlacklist(),s);a.removeClass("invalid too-weak very-weak weak good strong"),e.removeClass("invalid"),e.empty(),s?ejabat.password_strength>0?(0==i&&(a.addClass("too-weak"),e.html(ejabat.password_too_weak)),1==i?(a.addClass("very-weak"),e.html(ejabat.password_very_weak)):2==i?(a.addClass("weak"),e.html(ejabat.password_weak)):3==i?(a.addClass("good"),e.html(ejabat.password_good)):4==i&&(a.addClass("strong"),e.html(ejabat.password_strong)),ejabat.password_strength<=i?val_password=!0:(e.addClass("invalid"),val_password=!1)):val_password=!0:(a.addClass("invalid"),e.addClass("invalid"),e.html(ejabat.empty_field),val_password=!1)}function validatePasswordRetyped(a,e,s){var i=a.val(),l=e.val();l?i&&i!=l?(e.addClass("invalid"),s.addClass("invalid"),s.html(ejabat.passwords_mismatch),val_password_retyped=!1):(e.removeClass("invalid"),s.removeClass("invalid"),s.empty(),val_password_retyped=!0):(e.addClass("invalid"),s.addClass("invalid"),s.html(ejabat.empty_field),val_password_retyped=!1)}function validateEmail(a,e){a.removeClass("invalid"),e.removeClass("invalid"),e.html(ejabat.checking_email);var s=a.val();if(s){var i=new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i);i.test(s)?jQuery.ajax({method:"POST",url:ejabat.ajax_url+"?action=ejabat_validate_email",timeout:ejabat.timeout,data:"email="+s,dataType:"json",success:function(s){"success"==s.status?(a.removeClass("invalid"),e.removeClass("invalid"),e.empty(),val_email=!0):(a.addClass("invalid"),e.addClass("invalid"),e.html(ejabat.invalid_email),val_email=!1)},error:function(){a.addClass("invalid"),e.addClass("invalid"),e.html(ejabat.error),val_email=!1}}):(a.addClass("invalid"),e.addClass("invalid"),e.html(ejabat.invalid_email),val_email=!1)}else a.addClass("invalid"),e.addClass("invalid"),e.html(ejabat.empty_field),val_email=!1}function validateRecaptcha(a,e,s){var i=a.val();i||null==i?(e.removeClass("invalid"),s.removeClass("invalid"),s.empty(),val_recaptcha=!0):(e.addClass("invalid"),s.addClass("invalid"),s.html(ejabat.recaptcha_verify),val_recaptcha=!1)}function GetURLParameter(a){for(var e=window.location.search.substring(1),s=e.split("&"),i=0;i<s.length;i++){var l=s[i].split("=");if(l[0]==a)return l[1]}}var val_login,val_password,val_password_retyped,val_email,val_recaptcha;jQuery(document).ready(function(a){a.ajax({method:"POST",url:ejabat.ajax_url+"?action=ejabat_register_form",timeout:ejabat.timeout,data:"referer="+window.location.pathname+"&host="+GetURLParameter("host")+"&code="+GetURLParameter("code"),dataType:"json",success:function(e){a("#ejabat_register_form").replaceWith(e.data)},error:function(){a("#ejabat_register_form").replaceWith(ejabat.form_error)},complete:function(e,s){"success"==s&&(a("#login input").on("change",function(){a(this).val(a(this).val().toLowerCase().trim()),validateLogin(a(this),a("#host select"),a("#login span"))}),a("#host select").on("change",function(){a("#login input").val(a("#login input").val().toLowerCase().trim()),validateLogin(a("#login input"),a(this),a("#login span"))}),a("#password input").on("keyup change",function(e){var s=e.which||e.keyCode;9!==s&&16!==s&&validatePassword(a(this),a("#password span"))}),a("#password_retyped input").on("change",function(){validatePasswordRetyped(a("#password input"),a(this),a("#password_retyped span"))}),a("#email input").on("change",function(){validateEmail(a(this),a("#email span"))}),a("#ejabat_register").submit(function(){a("#response").css("display",""),a("#response").removeClass("ejabat-form-blocked ejabat-form-error ejabat-form-success"),a("#response").empty(),a("#spinner").css("visibility","visible"),validateRecaptcha(a("#g-recaptcha-response"),a("#g-recaptcha-0"),a("#recaptcha")),val_login&&val_password&&val_password_retyped&&val_email&&val_recaptcha?a.ajax({method:"POST",url:ejabat.ajax_url+"?action=ejabat_register",timeout:ejabat.timeout,data:a("#ejabat_register").serialize(),dataType:"json",success:function(e){"success"==e.status&&(a("#ejabat_register")[0].reset(),a("#password input").removeClass("weak good strong"),a("#password span").empty()),a("#response").css("display","inline-block"),a("#response").addClass("ejabat-form-"+e.status),a("#response").html(e.message),"undefined"!=typeof Recaptcha&&Recaptcha.reload(),"undefined"!=typeof grecaptcha&&grecaptcha.reset(),a("#spinner").css("visibility","hidden")},error:function(){a("#response").css("display","inline-block"),a("#response").addClass("ejabat-form-error"),a("#response").html(ejabat.error),a("#spinner").css("visibility","hidden")}}):(val_login||a("#login input").val()||(a("#login input").addClass("invalid"),a("#login span").addClass("invalid"),a("#login span").html(ejabat.empty_field)),val_password||a("#password input").val()||(a("#password input").addClass("invalid"),a("#password span").addClass("invalid"),a("#password span").html(ejabat.empty_field)),val_password_retyped||a("#password_retyped input").val()||(a("#password_retyped input").addClass("invalid"),a("#password_retyped span").addClass("invalid"),a("#password_retyped span").html(ejabat.empty_field)),val_email||a("#email input").val()||(a("#email input").addClass("invalid"),a("#email span").addClass("invalid"),a("#email span").html(ejabat.empty_field)),a("#response").css("display","inline-block"),a("#response").addClass("ejabat-form-blocked"),a("#response").html(ejabat.empty_fields),a("#spinner").css("visibility","hidden"))}))}})});